<!DOCTYPE html>
<html>
<head>
<title>Product Explorer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:sans-serif;background:#f5f7fa;margin:0}
header{background:#0f172a;color:white;padding:15px;font-size:20px}
#filters{padding:10px;background:white;display:flex;gap:10px}
#products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px;padding:20px}
.card{background:white;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.1);overflow:hidden}
.card img{width:100%;height:200px;object-fit:contain;background:#fff}
.card-body{padding:10px}
.price{font-weight:bold;font-size:18px}
.buy{display:block;background:#2563eb;color:white;text-align:center;padding:10px;text-decoration:none;border-radius:6px;margin-top:10px}
</style>
</head>

<body>
<header>ðŸ›’ Product Explorer</header>

<div id="filters">
<select id="category"></select>
<select id="country">
  <option value="">All Countries</option>
  <option value="usa">USA</option>
  <option value="india">India</option>
  <option value="uk">UK</option>
  <option value="canada">Canada</option>
</select>
</div>

<div id="products"></div>

<script>
let page=1, loading=false;

async function loadCategories(){
  const res=await fetch("http://localhost:8000/categories");
  const cats=await res.json();
  const sel=document.getElementById("category");
  sel.innerHTML='<option value="">All Categories</option>';
  cats.forEach(c=>{
    sel.innerHTML+=`<option value="${c}">${c}</option>`;
  });
}

async function loadProducts(reset=false){
  if(loading)return;
  loading=true;
  if(reset){document.getElementById("products").innerHTML="";page=1;}

  const cat=document.getElementById("category").value;
  const country=document.getElementById("country").value;

  let url=`http://localhost:8000/products?page=${page}&limit=40`;
  if(cat)url+=`&category_id=${cat}`;
  if(country)url+=`&country=${country}`;

  const res=await fetch(url);
  const data=await res.json();

  data.products.forEach(p=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <img src="${p.imageUrl}">
      <div class="card-body">
        <div>${p.title}</div>
        <div class="price">$${p.price}</div>
        <a class="buy" href="${p.productURL}" target="_blank">View</a>
      </div>`;
    document.getElementById("products").appendChild(div);
  });

  if(data.products.length>0)page++;
  loading=false;
}

document.getElementById("category").onchange=()=>loadProducts(true);
document.getElementById("country").onchange=()=>loadProducts(true);

window.onscroll=()=>{if(window.innerHeight+window.scrollY>document.body.offsetHeight-300)loadProducts();}

loadCategories();
loadProducts();
</script>
</body>
</html>
